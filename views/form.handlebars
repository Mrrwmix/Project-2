{{> header}}
<div class="row">
    <div class="input-field col s12">
        <select>
            <option value="" disabled selected>Categories</option>
            <option value="movie">Movies</option>
            <option value="book">Books</option>
            <option value="game">Games</option>
        </select>
        <label>Pick a Catagory</label>
    </div>
</div>

<div class="row">
    <form class="col s12">
        <div class="row">
            <div class="input-field col s6">
                <input placeholder="Title" id="title" type="text" class="validate">
                <label for="title">Title of Work to be Reviewed</label>
            </div>
            <div class="input-field col s6">
                <input id="user" type="text" class="validate">
                <label for="user">Your Name</label>
            </div>
        </div>
    </form>
</div>

<div class="row">
    <form class="col s12">
        <div class="row">
            <div class="input-field col s12">
                <input id="headliner" type="text" class="validate">
                <label for="headliner">Please Make a Title for Your Review</label>
            </div>
        </div>
    </form>
</div>

<div class="row">
    <form class="col s12">
        <div class="row">
            <div class="input-field col s12">
                <textarea id="review" class="materialize-textarea"></textarea>
                <label for="review">Review</label>
            </div>
        </div>
    </form>
</div>

<div class="row">
    <div class="col s12">
        <form action='#'>
            <p>
                <label>
                    <input class="with-gap" name="group1" type="radio" data-value="1">
                    <span for="group1" data-value="1">Worst</span>
                </label>
                <label>
                    <input class="with-gap" name="group1" type="radio" data-value="2">
                    <span for="group1" data-value="2">2</span>
                </label>
                <label>
                    <input class="with-gap" name="group1" type="radio" data-value="3">
                    <span for="group1" data-value="3">Ok</span>
                </label>
                <label>
                    <input class="with-gap" name="group1" type="radio" data-value="4">
                    <span for="group1" data-value="4">4</span>
                </label>
                <label>
                    <input class="with-gap" name="group1" type="radio" data-value="5">
                    <span for="group1" data-value="5">Best</span>
                </label>
            </p>
        </form>
    </div>
</div>

<button class="btn waves-effect waves-light" type="submit" name="action" id="submit">
    <i class="material-icons right">Submit</i>
</button>



<script>
    console.log("I'm ready!");

    $(document).ready(function () {
        $('select').formSelect();
    });

    $(document).on("click", "#submit", function () {
        console.log("click");
        /*console.log($("#title").val());
        console.log($("#user").val());
        console.log($("#review").val());
        console.log($("#headliner").val());
        console.log($("select").val()); // Getting the select value here
        console.log($("[name = group1]:checked").attr("data-value")); // Getting the radio button value here*/

        /* var newReview = {
             category: $("select").val().trim(),
             productName: $("#title").val().trim(),
             score: $("[name = group1]:checked").attr("data-value"),
             headline: $("#headliner").val().trim(),
             review: $("#review").val().trim(),
             UserId: 1                 //$("#user").val().trim()
         };
         console.log(newReview);*/


        // Send the POST request.
        /*   $.ajax("/api/reviews", {
               type: "POST",
               data: newReview
           }).then(function () {
               console.log("created new Review");
               // Reload the page to get the updated list
               location.reload();
           });*/
        var title = $("#title").val().trim();
        (console.log("title= " + title));
        var category = $("select").val();
        (console.log("category= " + category));


        switch (category) {
            case "movie":
                movieThis(title);
                break;

            //  case "book":
            //      bookThis(title);
            //      break;

            //  case "play":
            //      playThisGame(title);
            //      break;


            default:
                break;
        }
        function movieThis(title) {
            console.log(title);
            if (title == "") {
                title = "Mr. Nobody"
            }

            var queryURL = "http://www.omdbapi.com/?t=" + title + "&y=&plot=short&apikey=trilogy";

            console.log(queryURL);

            $.ajax({
                url: queryURL,
                method: "GET"
            })
                // After the data comes back from the API
                .then(function (response) {

                    // Storing an array of results in the results variable
                    console.log(response);
                    var image = response.Poster;
                    console.log(image);

                    var newReview = {
                        category: $("select").val().trim(),
                        productName: $("#title").val().trim(),
                        score: $("[name = group1]:checked").attr("data-value"),
                        headline: $("#headliner").val().trim(),
                        review: $("#review").val().trim(),
                        img: image,
                        UserId: 1                 //$("#user").val().trim()
                    }
                    console.log(newReview);

                    $.ajax("/api/reviews", {
                        type: "POST",
                        data: newReview
                    }).then(function () {
                        console.log("created new Review");
                        // Reload the page to get the updated list
                        location.reload();
                    });
                });
        };


    });

</script>